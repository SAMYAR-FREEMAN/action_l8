# name: CI

# on:
#   push:
#     branches: [main]
#   workflow_dispatch:
#     inputs:
#       test_number:
#         description: 'Number to check (Enter 1 or 2)'
#         required: true
#         default: '1'

# env:
#   PORT: ${{secrets.PORT}}

# jobs:
#   test_project:
#     runs-on: ubuntu-latest
#     environment: testing_stage
#     env:
#       shole: ${{secrets.SHOLE}}
#       PassWord: ${{secrets.PASSWORD}}
#     steps:
      
#       - uses: actions/checkout@v3

#       - name: Using custom action
#         id: test1
#         uses: ./.github/actions/test1
#         with:
#           INPUT_NUM: "${{ inputs.test_number || '1' }}"

#       - name: Print output of custom action
#         run: |
#           echo "${{ steps.test1.outputs.final_decision }}"

#       - name: Set up Python 3.9
#         uses: actions/setup-python@v3
#         with:
#           python-version: 3.9

#       - uses: actions/cache@v4
#         with:
#           path: ~/.cache/pip
#           key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
#           restore-keys: |
#             ${{ runner.os }}-pip-

#       - name: Install dependencies
#         run: |
#           python -m pip install --upgrade pip
#           if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

#       - name: Test with pytest
#         continue-on-error: true
#         run: |
#           pytest -v

#       - name: Unbreakable step
#         if: always() 
#         run: |
#           echo "This step will always run."
#           echo "Test Report Content" > report.txt

#       - name: Upload Report Txt
#         uses: actions/upload-artifact@v5
#         with:
#           name: Report_Of_Test_Py3.9_Ubuntu
#           path: report.txt

#       - name: Print env
#         run: |
#           echo "PORT: ${{env.PORT}}"
#           echo "shole: ${{env.shole}}"
#       - name: Using js action
#         id: js_action
#         uses: ./.github/actions/js_action
#         with:
#           rastakhiz: "2026-01-08"
#       - name: Print output of js action => js action
#         run: |
#           echo "out put is => ${{ steps.js_action.outputs.enqelab }}"
#   after_test_failure:
#     needs: test_project
#     if: failure()
#     runs-on: ubuntu-latest
#     steps:
#       - name: Print failure message
#         run: echo "Test failed!"

#   run_project:
#     needs: test_project
#     runs-on: ubuntu-latest
#     environment: deployment_stage
#     env:
#       shole: ${{secrets.SHOLE}}
#     steps:
#       - uses: actions/checkout@v3
#       - name: Run the project
#         run: echo "Running the project..."
#       - name: Print Env
#         run: |
#           echo "PORT: ${{env.PORT}}"

#   show_report:
#     needs: test_project
#     runs-on: ubuntu-latest
#     steps:
#       - name: Download Report Txt
#         uses: actions/download-artifact@v5
#         with:
#           name: Report_Of_Test_Py3.9_Ubuntu
#       - name: Display Report
#         run: cat report.txt


name: CI

on:
  push:
    branches: [main]
  workflow_dispatch:
    inputs:
      test_number:
        description: 'First number'
        required: true

      test_number2:
        description: 'Second number'
        required: true

env:
  PORT: ${{secrets.PORT}}

jobs:
  test_project:
    runs-on: ubuntu-latest
    environment: testing_stage
    env:
      shole: ${{secrets.SHOLE}}
      PassWord: ${{secrets.PASSWORD}}

    steps:
      - uses: actions/checkout@v3
      - name: Using js action
        id: js_action
        uses: ./.github/actions/js_action
        with:
          num: "${{ inputs.test_number }}"
          num2: "${{ inputs.test_number2 }}"

      - name: Print output of js action
        run: |
          echo "Result is => ${{ steps.js_action.outputs.Result }}"

      - name: Set up Python 3.9
        uses: actions/setup-python@v3
        with:
          python-version: 3.9

      - uses: actions/cache@v4
        with:
          path: ~/.cache/pip
          key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
          restore-keys: |
            ${{ runner.os }}-pip-

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      - name: Test with pytest
        continue-on-error: true
        run: |
          pytest -v

      - name: Unbreakable step
        if: always() 
        run: |
          echo "This step will always run."
          echo "Test Report Content" > report.txt

      - name: Upload Report Txt
        uses: actions/upload-artifact@v5
        with:
          name: Report_Of_Test_Py3.9_Ubuntu
          path: report.txt

      - name: Print env
        run: |
          echo "PORT: ${{env.PORT}}"
          echo "shole: ${{env.shole}}"

  after_test_failure:
    needs: test_project
    if: failure()
    runs-on: ubuntu-latest
    steps:
      - name: Print failure message
        run: echo "Test failed!"

  run_project:
    needs: test_project
    runs-on: ubuntu-latest
    environment: deployment_stage
    env:
      shole: ${{secrets.SHOLE}}
    steps:
      - uses: actions/checkout@v3
      - name: Run the project
        run: echo "Running the project..."
      - name: Print Env
        run: |
          echo "PORT: ${{env.PORT}}"

  show_report:
    needs: test_project
    runs-on: ubuntu-latest
    steps:
      - name: Download Report Txt
        uses: actions/download-artifact@v5
        with:
          name: Report_Of_Test_Py3.9_Ubuntu
      - name: Display Report
        run: cat report.txt